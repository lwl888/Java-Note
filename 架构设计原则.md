## 业务架构设计原则

### 业务平台化

- 业务平台化，相互独立。 如交易平台、仓储平台、物流平台、支付平台、广告平台等
- 基础业务下沉，可复用。如用户、商品、类目、促销、时效等

### 核心业务、非核心业务分离

- 电商核心业务与非核心业务分离
- 核心业务精简（利于稳定），非核心业务多样化。如，主交易服务、通用交易服务

### 隔离不同类型的业务

- 交易业务是签订买家和卖家之间的交易合同，需要优先保证高可用性，让用户能快速下单
- 履约业务对可用性没有太高要求，可以优先保证一致性
- 闪购业务对高并发要求很高，应该跟普通业务隔离



### 区分主流程、辅流程

分清哪些是电商的主流程。运行时，优先保证主流程的顺利完成，辅流程可以采用后台异步的方式。避免辅流程的失败导致主流程的回滚。如，下单时，同步调用快照，异步通知台账、发票

## 应用架构设计原则

### 稳定性设计

- 一切以稳定为中心
- 架构尽可能简单、清晰
- 不过度设计

### 解耦/拆分

- 稳定部分与易变部分分离
- 核心业务与非核心业务分离
- 电商主流程与辅流程分离
- 应用与数据分离
- 服务与实现细节分离

### 抽象化

- 应用抽象化：应用只依赖服务抽象，不依赖服务实现细节、位置
- 数据库抽象化：应用只依赖逻辑数据库，不需要关心物理库的位置和分片
- 服务器抽象化：应用虚拟化部署，不需要关心实体机配置，动态调配资源

### 松耦合

- 跨域调用异步化：不同业务域之间尽量异步解耦
- 非核心业务尽量异步化：核心、非核心业务之间，尽量异步解耦
- 必须同步调用时，需要设置超时时间和任务队列长度

### 容错设计

- 服务自治：服务能彼此独立修改、 部署、发布和管理。避免引发连 锁反应 
- 集群容错：应用系统集群，避免单点 
- 多机房容灾：多机房部署，多活

## 服务设计原则

### 无状态

- 尽量不要把状态数据保留在本机
- 接口调用幂等

### 可复用

- 复用粒度是有业务逻辑的抽象服务，不是服务实现细节
- 服务引用只依赖于服务抽象

### 松耦合

- 跨业务域调用，尽可能异步解耦
- 必须同步调用时，设置超时和队列大小
- 相对稳定的基本服务与易变流程服务分层

### 可治理

- 制订服务契约
- 服务可降级
- 服务可限流
- 服务可开关
- 服务可监控
- 白名单机制

### 基础服务

- 基础服务下沉、可复用。如时效、库存、价格计算等
- 基础服务自治，相互独立
- 基础服务的实现，要求精简、可水平扩展
- 基础服务实现物理隔离，包括基础服务相关的数据

## 服务依赖原则

### 依赖稳定部分

- 稳定部分不依赖易变部分
- 易变部分可以依赖稳定部分
- 要求：避免循环依赖

### 跨域弱依赖

- 跨业务域调用时，尽可能异步弱依赖

### 基本服务依赖

- 基本服务不能向上依赖流程服务
- 组合服务、流程服务可以向下依赖基本服务
- 条件：基本服务稳定

### 非功能性服务依赖

- 非功能性服务不依赖功能性服务
- 功能性服务可依赖非功能性服务
- 条件：非功能性服务稳定

### 平台服务依赖

- 平台服务不依赖上层应用
- 上层应用可依赖平台服务
- 条件：平台服务稳定

### 核心服务依赖

- 核心服务不依赖非核心服务
- 非核心服务可依赖核心服务
- 条件：核心服务稳定

